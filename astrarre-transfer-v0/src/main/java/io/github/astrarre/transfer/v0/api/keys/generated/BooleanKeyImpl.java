package io.github.astrarre.transfer.v0.api.keys.generated;
// this class is autogenerated
// @formatter:off

import io.github.astrarre.transfer.v0.api.TransactionHandler;
import io.github.astrarre.transfer.v0.api.Key;
import io.github.astrarre.transfer.v0.api.Transaction;
import it.unimi.dsi.fastutil.booleans.BooleanArrayList;

public class BooleanKeyImpl extends Key.Boolean {
	private final TransactionHandler handler;
	private final BooleanArrayList values = new BooleanArrayList();

	public BooleanKeyImpl(TransactionHandler handler, boolean originalValue) {
		this.handler = handler;
		this.values.add(0, originalValue);
	}

	public BooleanKeyImpl(boolean originalValue) {this(new TransactionHandler(), originalValue);}

	@Override
	public boolean get(Transaction transaction) {
		return this.values.peekBoolean(0);
	}

	@Override
	protected void onApply(Transaction transaction) {
		this.handler.pop(transaction);
		Transaction parent = transaction.getParent();
		this.set(parent, this.values.popBoolean());
	}

	@Override
	protected void onAbort(Transaction transaction) {
		this.values.popBoolean();
		this.handler.pop(transaction);
	}

	@Override
	public void set(Transaction transaction, boolean val) {
		if (this.handler.store(transaction)) {
			this.values.set(this.values.size() - 1, val);
		} else {
			this.values.push(val);
			transaction.enlistKey(this);
		}
	}
}
